<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Transform the 3D location of objects such as neurons — xform • nat</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">nat</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/Installation.html">Installation Details</a>
    </li>
    <li>
      <a href="../articles/neurons-intro.html">Introduction to neurons and neuronlists</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/jefferis/nat">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Transform the 3D location of objects such as neurons</h1>
    </div>

    
    <p><code>xform</code> is designed to operate on a variety of data types, especially 
objects encapsulating neurons. <code>xform</code> depends on two specialised 
downstream functions <code><a href='xformpoints.html'>xformpoints</a></code> and <code><a href='xformimage.html'>xformimage</a></code>. 
These are user visible any contain some useful documentation, but should only
be required for expert use; in almost all circumstances, you should use only 
<code>xform</code>.

    <code>xform.character</code> is designed to work with files on disk.
  Presently it is restricted to images, although other datatypes may be
  supported in future.</p>
    

    <pre class="usage"><span class='fu'>xform</span>(<span class='no'>x</span>, <span class='no'>reg</span>, <span class='no'>...</span>)

<span class='co'># S3 method for default</span>
<span class='fu'>xform</span>(<span class='no'>x</span>, <span class='no'>reg</span>, <span class='kw'>na.action</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"warn"</span>, <span class='st'>"none"</span>, <span class='st'>"drop"</span>,
  <span class='st'>"error"</span>), <span class='no'>...</span>)

<span class='co'># S3 method for character</span>
<span class='fu'>xform</span>(<span class='no'>x</span>, <span class='no'>reg</span>, <span class='no'>...</span>)

<span class='co'># S3 method for list</span>
<span class='fu'>xform</span>(<span class='no'>x</span>, <span class='no'>reg</span>, <span class='kw'>FallBackToAffine</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>na.action</span> <span class='kw'>=</span> <span class='st'>"error"</span>,
  <span class='no'>...</span>)

<span class='co'># S3 method for shape3d</span>
<span class='fu'>xform</span>(<span class='no'>x</span>, <span class='no'>reg</span>, <span class='kw'>FallBackToAffine</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>na.action</span> <span class='kw'>=</span> <span class='st'>"error"</span>, <span class='no'>...</span>)

<span class='co'># S3 method for neuron</span>
<span class='fu'>xform</span>(<span class='no'>x</span>, <span class='no'>reg</span>, <span class='kw'>FallBackToAffine</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>na.action</span> <span class='kw'>=</span> <span class='st'>"error"</span>,
  <span class='no'>...</span>)

<span class='co'># S3 method for data.frame</span>
<span class='fu'>xform</span>(<span class='no'>x</span>, <span class='no'>reg</span>, <span class='kw'>subset</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>...</span>)

<span class='co'># S3 method for dotprops</span>
<span class='fu'>xform</span>(<span class='no'>x</span>, <span class='no'>reg</span>, <span class='kw'>FallBackToAffine</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='no'>...</span>)

<span class='co'># S3 method for neuronlist</span>
<span class='fu'>xform</span>(<span class='no'>x</span>, <span class='no'>reg</span>, <span class='kw'>subset</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>...</span>, <span class='kw'>OmitFailures</span> <span class='kw'>=</span> <span class='fl'>NA</span>,
  <span class='kw'>VectoriseRegistrations</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>TransformDFCoords</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>an object to transform</p></td>
    </tr>
    <tr>
      <th>reg</th>
      <td><p>A registration defined by a matrix, a function, a <code>cmtkreg</code> 
object, or a character vector specifying a path to one or more 
registrations on disk (see Registrations section).</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>additional arguments passed to methods and eventually to 
<code><a href='xformpoints.html'>xformpoints</a></code></p></td>
    </tr>
    <tr>
      <th>na.action</th>
      <td><p>How to handle NAs. NB drop may not work for some classes.</p></td>
    </tr>
    <tr>
      <th>FallBackToAffine</th>
      <td><p>Whether to use an affine transform when a cmtk
warping transformation fails.</p></td>
    </tr>
    <tr>
      <th>subset</th>
      <td><p>For <code>xform.neuronlist</code> indices (character/logical/integer)
that specify a subset of the members of <code>x</code> to be transformed.</p></td>
    </tr>
    <tr>
      <th>OmitFailures</th>
      <td><p>Whether to omit neurons for which <code>FUN</code> gives an 
error. The default value (<code>NA</code>) will result in nlapply stopping with 
an error message the moment there is an eror. For other values, see 
details.</p></td>
    </tr>
    <tr>
      <th>VectoriseRegistrations</th>
      <td><p>When <code>FALSE</code>, the default, each element of
<code>reg</code> will be applied sequentially to each element of <code>x</code>. When 
<code>TRUE</code>, it is assumed that there is one element of <code>reg</code> for each
element of <code>x</code>.</p></td>
    </tr>
    <tr>
      <th>TransformDFCoords</th>
      <td><p>If the metadata <code>data.frame</code> attached to 
<code>x</code> includes columns that look like x,y,z coordinates, transform those
as well.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Methods are provided for some specialised S3 classes. Further 
  methods can of course be constructed for user-defined S3 classes. However 
  this will probably not be necessary if the <code>xyzmatrix</code> and 
  <code>`xyzmatrix&lt;-`</code> generics are suitably overloaded <em>and</em> the S3 
  object inherits from <code>list</code>.</p>  
<p>Note that given the behaviour of the <code>xyzmatrix</code> functions, the
  <code>xform.data.frame</code> method will transform the x,y,z or X,Y,Z columns of
  a data.frame if the data.frame has more than 3 columns, erroring out if no
  such unique columns exist.</p>
<p>TODO get this to work for matrices with more than 3 columns by
  working on xyzmatrix definition.</p>
<p>For the <code>xform.dotprops</code> method, dotprops tangent vectors will 
  be recalculated from scratch after the points have been transformed (even 
  though the tangent vectors could in theory be transformed more or less 
  correctly). When there are multiple transformations, <code>xform</code> will take
  care to carry out all transformations before recalculating the vectors.</p>
<p>With <code>xform.neuronlist</code>, if you want to apply a different 
  registration to each object in the neuronlist <code>x</code>, then you should use
  <code>VectoriseRegistrations=TRUE</code>.</p>  
<p>When <code>x</code>'s attached data.frame contains columns called x,y,z or X,Y,Z 
  then these are assumed to be coordinates and also transformed when 
  <code>TransformDFCoords=TRUE</code> (the default). This provides a mechanism for 
  transforming the soma positions of <code>neuronlist</code> objects containing 
  <code>dotprops</code> objects (which do not otherwise store the soma position).
  Note that if transformation fails, a warning will be issued and the points
  will be replaced with <code>NA</code> values.</p>
    
    <h2 class="hasAnchor" id="registrations"><a class="anchor" href="#registrations"></a>Registrations</h2>

    
    <p>When <code>reg</code> is a character vector, xform's specialised downstream 
  functions will check to see if it defines a path to one (or more) 
  registrations on disk. These can be of two classes</p>  
<p></p><ul>
<li><p>CMTK registrations</p></li>
<li><p><code><a href='reglist.html'>reglist</a></code> objects saved in R's <code>RDS</code> format (see 
  <code>readRDS</code>) which can contain any sequence of registrations 
  supported by nat.</p></li>
</ul>
    <p>If the path does indeed point to a CMTK registration, this method will hand
  off to <code>xformpoints.cmtkreg</code> or <code>xformimages.cmtkreg</code>. In this
  case, the character vector may optionally have an attribute, 'swap', a
  logical vector of the same length indicating whether the transformation
  direction should be swapped. At the moment only CMTK registration files are
  supported.</p>  
<p>If <code>reg</code> is a character vector of length &gt;=1 defining a sequence of 
  registration files on disk they should proceed from sample to reference.</p>  
<p>Where <code>reg</code> is a function, it should have a signature like 
  <code>myfun(x,), ...</code> where the <code>...</code> <strong>must</strong> be provided in 
  order to swallow any arguments passed from higher level functions that are 
  not relevant to this particular transformation function.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <p><code><a href='xformpoints.html'>xformpoints</a></code></p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='co'># NOT RUN {</span>
<span class='no'>kc1</span><span class='kw'>=</span><span class='no'>kcs20</span><span class='kw'>[[</span><span class='fl'>1</span>]]
<span class='no'>kc1.default</span><span class='kw'>=</span><span class='fu'>xform</span>(<span class='no'>kc1</span>,<span class='kw'>function</span>(<span class='no'>x</span>,<span class='no'>...</span>) <span class='no'>x</span>)
<span class='fu'>stopifnot</span>(<span class='fu'>isTRUE</span>(<span class='fu'>all.equal</span>(<span class='no'>kc1</span>,<span class='no'>kc1.default</span>)))
<span class='no'>kc1.5</span><span class='kw'>=</span><span class='fu'>xform</span>(<span class='no'>kc1</span>,<span class='kw'>function</span>(<span class='no'>x</span>,<span class='no'>...</span>) <span class='no'>x</span>, <span class='kw'>k</span><span class='kw'>=</span><span class='fl'>5</span>)
<span class='fu'>stopifnot</span>(<span class='fu'>isTRUE</span>(<span class='fu'>all.equal</span>(<span class='no'>kc1.5</span>,<span class='no'>kc1.default</span>)))
<span class='no'>kc1.20</span><span class='kw'>=</span><span class='fu'>xform</span>(<span class='no'>kc1</span>,<span class='kw'>function</span>(<span class='no'>x</span>,<span class='no'>...</span>) <span class='no'>x</span>, <span class='kw'>k</span><span class='kw'>=</span><span class='fl'>20</span>)
<span class='fu'>stopifnot</span>(!<span class='fu'>isTRUE</span>(<span class='fu'>all.equal</span>(<span class='no'>kc1</span>,<span class='no'>kc1.20</span>)))

<span class='co'># apply two registrations converting sample-&gt;IS2-&gt;JFRC2</span>
<span class='no'>reg_seq</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='st'>"IS2_sample.list"</span>, <span class='st'>"JFRC2_IS2.list"</span>)
<span class='fu'>xform</span>(<span class='no'>kc1</span>, <span class='no'>reg_seq</span>)
<span class='co'># apply two registrations, swapping the direction of the second one</span>
<span class='co'># i.e. sample -&gt; IS2 -&gt; FCWB</span>
<span class='no'>reg_seq</span><span class='kw'>=</span><span class='fu'>structure</span>(<span class='fu'>c</span>(<span class='st'>"IS2_sample.list"</span>, <span class='st'>"IS2_FCWB.list"</span>), <span class='kw'>swap</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='fl'>FALSE</span>, <span class='fl'>TRUE</span>))
<span class='fu'>xform</span>(<span class='no'>kc1</span>, <span class='no'>reg_seq</span>)
<span class='co'># }</span><span class='co'># NOT RUN {</span>
<span class='co'># apply reg1 to Cell07PNs[[1]], reg2 to Cell07PNs[[2]] etc</span>
<span class='no'>regs</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='no'>reg1</span>, <span class='no'>reg2</span>, <span class='no'>reg3</span>)
<span class='no'>nx</span><span class='kw'>=</span><span class='fu'>xform</span>(<span class='no'>Cell07PNs</span>[<span class='fl'>1</span>:<span class='fl'>3</span>], <span class='kw'>reg</span><span class='kw'>=</span><span class='no'>regs</span>, <span class='kw'>VectoriseRegistrations</span><span class='kw'>=</span><span class='fl'>TRUE</span>)
<span class='co'># }</span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#details">Details</a></li>

      <li><a href="#registrations">Registrations</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Gregory Jefferis, James Manton.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
