<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<title>xform. nat 1.8.6</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="author" content="">

<link href="css/bootstrap.css" rel="stylesheet">
<link href="css/bootstrap-responsive.css" rel="stylesheet">
<link href="css/highlight.css" rel="stylesheet">
<link href="css/staticdocs.css" rel="stylesheet">

<!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
  </head>

  <body>
    <div class="navbar">
  <div class="navbar-inner">
    <div class="container">
      <a class="brand" href="index.html">nat 1.8.6</a>
      <div class="nav">
        <ul class="nav">
          <li><a href="index.html">Home</a></li>
          <li><a href="reference.html">Reference</a></li>
        </ul>
      </div>
    </div>
  </div>
</div>


    <div class="container">
      <header>
        
      </header>
      
      <h1>Transform the 3D location of objects such as neurons</h1>

<div class="row">
  <div class="span8">
    <h2>Usage</h2>
    <pre><span class="functioncall"><a href='xform.html'>xform</a></span><span class="keyword">(</span><span class="symbol">x</span><span class="keyword">,</span> <span class="symbol">reg</span><span class="keyword">,</span> <span class="symbol">...</span><span class="keyword">)</span>

<span class="comment"># S3 method for default</span>
<span class="functioncall"><a href='xform.html'>xform</a></span><span class="keyword">(</span><span class="symbol">x</span><span class="keyword">,</span> <span class="symbol">reg</span><span class="keyword">,</span> <span class="argument">na.action</span>&nbsp;<span class="argument">=</span>&nbsp;<span class="functioncall"><a href='http://www.rdocumentation.org/packages/base/topics/c'>c</a></span><span class="keyword">(</span><span class="string">"warn"</span><span class="keyword">,</span> <span class="string">"none"</span><span class="keyword">,</span> <span class="string">"drop"</span><span class="keyword">,</span>
  <span class="string">"error"</span><span class="keyword">)</span><span class="keyword">,</span> <span class="symbol">...</span><span class="keyword">)</span>

<span class="comment"># S3 method for character</span>
<span class="functioncall"><a href='xform.html'>xform</a></span><span class="keyword">(</span><span class="symbol">x</span><span class="keyword">,</span> <span class="symbol">reg</span><span class="keyword">,</span> <span class="symbol">...</span><span class="keyword">)</span>

<span class="comment"># S3 method for list</span>
<span class="functioncall"><a href='xform.html'>xform</a></span><span class="keyword">(</span><span class="symbol">x</span><span class="keyword">,</span> <span class="symbol">reg</span><span class="keyword">,</span> <span class="argument">FallBackToAffine</span>&nbsp;<span class="argument">=</span>&nbsp;<span class="number">TRUE</span><span class="keyword">,</span> <span class="argument">na.action</span>&nbsp;<span class="argument">=</span>&nbsp;<span class="string">"error"</span><span class="keyword">,</span>
  <span class="symbol">...</span><span class="keyword">)</span>

<span class="comment"># S3 method for shape3d</span>
<span class="functioncall"><a href='xform.html'>xform</a></span><span class="keyword">(</span><span class="symbol">x</span><span class="keyword">,</span> <span class="symbol">reg</span><span class="keyword">,</span> <span class="argument">FallBackToAffine</span>&nbsp;<span class="argument">=</span>&nbsp;<span class="number">TRUE</span><span class="keyword">,</span>
  <span class="argument">na.action</span>&nbsp;<span class="argument">=</span>&nbsp;<span class="string">"error"</span><span class="keyword">,</span> <span class="symbol">...</span><span class="keyword">)</span>

<span class="comment"># S3 method for neuron</span>
<span class="functioncall"><a href='xform.html'>xform</a></span><span class="keyword">(</span><span class="symbol">x</span><span class="keyword">,</span> <span class="symbol">reg</span><span class="keyword">,</span> <span class="argument">FallBackToAffine</span>&nbsp;<span class="argument">=</span>&nbsp;<span class="number">TRUE</span><span class="keyword">,</span> <span class="argument">na.action</span>&nbsp;<span class="argument">=</span>&nbsp;<span class="string">"error"</span><span class="keyword">,</span>
  <span class="symbol">...</span><span class="keyword">)</span>

<span class="comment"># S3 method for data.frame</span>
<span class="functioncall"><a href='xform.html'>xform</a></span><span class="keyword">(</span><span class="symbol">x</span><span class="keyword">,</span> <span class="symbol">reg</span><span class="keyword">,</span> <span class="argument">subset</span>&nbsp;<span class="argument">=</span>&nbsp;NULL<span class="keyword">,</span> <span class="symbol">...</span><span class="keyword">)</span>

<span class="comment"># S3 method for dotprops</span>
<span class="functioncall"><a href='xform.html'>xform</a></span><span class="keyword">(</span><span class="symbol">x</span><span class="keyword">,</span> <span class="symbol">reg</span><span class="keyword">,</span> <span class="argument">FallBackToAffine</span>&nbsp;<span class="argument">=</span>&nbsp;<span class="number">TRUE</span><span class="keyword">,</span> <span class="symbol">...</span><span class="keyword">)</span>

<span class="comment"># S3 method for neuronlist</span>
<span class="functioncall"><a href='xform.html'>xform</a></span><span class="keyword">(</span><span class="symbol">x</span><span class="keyword">,</span> <span class="symbol">reg</span><span class="keyword">,</span> <span class="argument">subset</span>&nbsp;<span class="argument">=</span>&nbsp;NULL<span class="keyword">,</span> <span class="symbol">...</span><span class="keyword">,</span> <span class="argument">OmitFailures</span>&nbsp;<span class="argument">=</span>&nbsp;<span class="number">NA</span><span class="keyword">,</span>
  <span class="argument">VectoriseRegistrations</span>&nbsp;<span class="argument">=</span>&nbsp;<span class="number">FALSE</span><span class="keyword">,</span> <span class="argument">TransformDFCoords</span>&nbsp;<span class="argument">=</span>&nbsp;<span class="number">TRUE</span><span class="keyword">)</span></pre>
    
    <h2>Arguments</h2>
    <dl>
      <dt>x</dt>
      <dd>an object to transform</dd>
      <dt>reg</dt>
      <dd>A registration defined by a matrix, a function, a <code>cmtkreg</code> 
object, or a character vector specifying a path to one or more 
registrations on disk (see Registrations section).</dd>
      <dt>...</dt>
      <dd>additional arguments passed to methods and eventually to 
<code><a href='xformpoints.html'>xformpoints</a></code></dd>
      <dt>na.action</dt>
      <dd>How to handle NAs. NB drop may not work for some classes.</dd>
      <dt>FallBackToAffine</dt>
      <dd>Whether to use an affine transform when a cmtk
warping transformation fails.</dd>
      <dt>subset</dt>
      <dd>For <code>xform.neuronlist</code> indices (character/logical/integer)
that specify a subset of the members of <code>x</code> to be transformed.</dd>
      <dt>OmitFailures</dt>
      <dd>Whether to omit neurons for which <code>FUN</code> gives an 
error. The default value (<code>NA</code>) will result in nlapply stopping with 
an error message the moment there is an eror. For other values, see 
details.</dd>
      <dt>VectoriseRegistrations</dt>
      <dd>When <code>FALSE</code>, the default, each element of
<code>reg</code> will be applied sequentially to each element of <code>x</code>. When 
<code>TRUE</code>, it is assumed that there is one element of <code>reg</code> for each
element of <code>x</code>.</dd>
      <dt>TransformDFCoords</dt>
      <dd>If the metadata <code>data.frame</code> attached to 
<code>x</code> includes columns that look like x,y,z coordinates, transform those
as well.</dd>
    </dl>
    
    <div class="Description">
      <h2>Description</h2>

      <p><code>xform</code> is designed to operate on a variety of data types, especially 
objects encapsulating neurons. <code>xform</code> depends on two specialised 
downstream functions <code><a href='xformpoints.html'>xformpoints</a></code> and <code><a href='xformimage.html'>xformimage</a></code>. 
These are user visible any contain some useful documentation, but should only
be required for expert use; in almost all circumstances, you should use only 
<code>xform</code>.</p>

      <p><code>xform.character</code> is designed to work with files on disk.
  Presently it is restricted to images, although other datatypes may be
  supported in future.</p>

    </div>

    <div class="Details">
      <h2>Details</h2>

      <p>Methods are provided for some specialised S3 classes. Further 
  methods can of course be constructed for user-defined S3 classes. However 
  this will probably not be necessary if the <code>xyzmatrix</code> and 
  <code>`xyzmatrix&lt;-`</code> generics are suitably overloaded <em>and</em> the S3 
  object inherits from <code>list</code>.</p>

      <p>Note that given the behaviour of the <code>xyzmatrix</code> functions, the
  <code>xform.data.frame</code> method will transform the x,y,z or X,Y,Z columns of
  a data.frame if the data.frame has more than 3 columns, erroring out if no
  such unique columns exist.</p>

      <p>TODO get this to work for matrices with more than 3 columns by
  working on xyzmatrix definition.</p>

      <p>For the <code>xform.dotprops</code> method, dotprops tangent vectors will 
  be recalculated from scratch after the points have been transformed (even 
  though the tangent vectors could in theory be transformed more or less 
  correctly). When there are multiple transformations, <code>xform</code> will take
  care to carry out all transformations before recalculating the vectors.</p>

      <p>With <code>xform.neuronlist</code>, if you want to apply a different 
  registration to each object in the neuronlist <code>x</code>, then you should use
  <code>VectoriseRegistrations=TRUE</code>.</p>

      <p>When <code>x</code>&#39;s attached data.frame contains columns called x,y,z or X,Y,Z 
  then these are assumed to be coordinates and also transformed when 
  <code>TransformDFCoords=TRUE</code> (the default). This provides a mechanism for 
  transforming the soma positions of <code>neuronlist</code> objects containing
  <code>dotprops</code> objects.</p>

    </div>

    <div class="Registrations">
      <h2>Registrations</h2>

      <p></p>

      <p>When <code>reg</code> is a character vector, xform&#39;s specialised downstream 
  functions will check to see if it defines a path to one (or more) 
  registrations on disk. These can be of two classes</p>

      <p><ul>
<li> CMTK registrations</p>

      <p></li>
<li> <code><a href='reglist.html'>reglist</a></code> objects saved in R&#39;s <code>RDS</code> format (see 
  <code><a href='http://www.rdocumentation.org/packages/base/topics/readRDS'>readRDS</a></code>) which can contain any sequence of registrations 
  supported by nat.</p>

      <p></li>
</ul></p>

      <p>If the path does indeed point to a CMTK registration, this method will hand
  off to <code>xformpoints.cmtkreg</code> or <code>xformimages.cmtkreg</code>. In this
  case, the character vector may optionally have an attribute, &#39;swap&#39;, a
  logical vector of the same length indicating whether the transformation
  direction should be swapped. At the moment only CMTK registration files are
  supported.</p>

      <p>If <code>reg</code> is a character vector of length &gt;=1 defining a sequence of 
  registration files on disk they should proceed from sample to reference.</p>

      <p>Where <code>reg</code> is a function, it should have a signature like 
  <code>myfun(x,), ...</code> where the <code>...</code> <strong>must</strong> be provided in 
  order to swallow any arguments passed from higher level functions that are 
  not relevant to this particular transformation function.</p>

    </div>
    
    <h2 id="examples">Examples</h2>
    <pre class="examples"><div class='input'><span class="comment">## Not run: ------------------------------------</span>
<span class="comment"># kc1=kcs20[[1]]</span>
<span class="comment"># kc1.default=xform(kc1,function(x,...) x)</span>
<span class="comment"># stopifnot(isTRUE(all.equal(kc1,kc1.default)))</span>
<span class="comment"># kc1.5=xform(kc1,function(x,...) x, k=5)</span>
<span class="comment"># stopifnot(isTRUE(all.equal(kc1.5,kc1.default)))</span>
<span class="comment"># kc1.20=xform(kc1,function(x,...) x, k=20)</span>
<span class="comment"># stopifnot(!isTRUE(all.equal(kc1,kc1.20)))</span>
<span class="comment"># </span>
<span class="comment"># # apply two registrations converting sample-&gt;IS2-&gt;JFRC2</span>
<span class="comment"># reg_seq=c("IS2_sample.list", "JFRC2_IS2.list")</span>
<span class="comment"># xform(kc1, reg_seq)</span>
<span class="comment"># # apply two registrations, swapping the direction of the second one</span>
<span class="comment"># # i.e. sample -&gt; IS2 -&gt; FCWB</span>
<span class="comment"># reg_seq=structure(c("IS2_sample.list", "IS2_FCWB.list"), swap=c(FALSE, TRUE))</span>
<span class="comment"># xform(kc1, reg_seq)</span>
<span class="comment">## ---------------------------------------------</span>
<span class="comment">## Not run: ------------------------------------</span>
<span class="comment"># # apply reg1 to Cell07PNs[[1]], reg2 to Cell07PNs[[2]] etc</span>
<span class="comment"># regs=c(reg1, reg2, reg3)</span>
<span class="comment"># nx=xform(Cell07PNs[1:3], reg=regs, VectoriseRegistrations=TRUE)</span>
<span class="comment">## ---------------------------------------------</span></div></pre>
  </div>
  <div class="span4 sidebar">
    <!-- <ul>
      <li>xform</li><li>xform.character</li><li>xform.data.frame</li><li>xform.default</li><li>xform.dotprops</li><li>xform.list</li><li>xform.neuron</li><li>xform.neuronlist</li><li>xform.shape3d</li>
    </ul>
    <ul>
      
    </ul> -->

    <h2>See also</h2>
      <p><code><a href='xformpoints.html'>xformpoints</a></code></p>

    


  </div>
</div>
      
      <footer>
      <p class="pull-right"><a href="#">Back to top</a></p>
<p>Built by <a href="https://github.com/hadley/staticdocs">staticdocs</a>. Styled with <a href="https://getbootstrap.com/2.0.4/">bootstrap</a>.</p>
      </footer>
    </div>
  </body>
</html>