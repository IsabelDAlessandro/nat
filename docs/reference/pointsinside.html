<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Find which points of an object are inside a surface — pointsinside • nat</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
<meta property="og:title" content="Find which points of an object are inside a surface — pointsinside" />

<meta property="og:description" content="Find which points of an object are inside a surface" />
<meta name="twitter:card" content="summary" />


<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">nat</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">1.8.12.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/Installation.html">Installation details</a>
    </li>
    <li>
      <a href="../articles/NeuroGeometry.html">NeuroGeometry: Analysing 3D morphology of neurons</a>
    </li>
    <li>
      <a href="../articles/neurons-as-graph.html">Working with individual neurons as graph structures</a>
    </li>
    <li>
      <a href="../articles/neurons-intro.html">Introduction to neurons and neuronlists</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/jefferis/nat">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Find which points of an object are inside a surface</h1>
    <small>Source: <a href='https://github.com/jefferis/nat/blob/master/R/hxsurf.R'><code>R/hxsurf.R</code></a></small>
    </div>

    
    <p>Find which points of an object are inside a surface</p>
    

    <pre class="usage"><span class='fu'>pointsinside</span>(<span class='no'>x</span>, <span class='no'>surf</span>, <span class='no'>...</span>)

<span class='co'># S3 method for default</span>
<span class='fu'>pointsinside</span>(<span class='no'>x</span>, <span class='no'>surf</span>, <span class='no'>...</span>, <span class='kw'>rval</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"logical"</span>, <span class='st'>"distance"</span>,
  <span class='st'>"mesh3d"</span>))</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>an object with 3D points.</p></td>
    </tr>
    <tr>
      <th>surf</th>
      <td><p>The reference surface - either a <code>mesh3d</code> object or any 
object that can be converted using <code>as.mesh3d</code> including <code>hxsurf</code>
and <code>ashape3d</code> objects.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>additional arguments for methods, eventually passed to as.mesh3d.</p></td>
    </tr>
    <tr>
      <th>rval</th>
      <td><p>what to return.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A vector of logical values or distances (positive inside, negative
  outside) equal to the number of points in x or the <code>mesh3d</code> object
  returned by <code><a href='http://www.rdocumentation.org/packages/Rvcg/topics/vcgClostKD'>Rvcg::vcgClostKD</a></code>.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Note that <code>hxsurf</code> surface objects will be converted to 
  <code>mesh3d</code> before being passed to <code><a href='http://www.rdocumentation.org/packages/Rvcg/topics/vcgClostKD'>Rvcg::vcgClostKD</a></code>, so if you are 
  testing repeatedly against the same surface, it may make sense to 
  pre-convert.</p>  
<p><code>pointsinside</code> depends on the face normals for each face pointing out 
  of the object (see example). The face normals are defined by the order of 
  the three vertices making up a triangular face. You can flip the face 
  normal for a face by permuting the vertices (i.e. 1,2,3 -&gt; 1,3,2). If you 
  find for a given surface that points are outside when you expect them to be
  inside then the face normals are probably all the wrong way round. You can 
  invert them yourself or use the <code><a href='http://www.rdocumentation.org/packages/Morpho/topics/invertFaces'>Morpho::invertFaces</a></code> function to fix 
  this.</p>  
<p>If you find that some points but not all points are not behaving as you 
  would expect, then it may be that some faces are not coherently oriented. 
  The <code>Rvcg::<a href='http://www.rdocumentation.org/packages/Rvcg/topics/vcgClean'>vcgClean</a></code> function can sometimes be used to 
  correct the orientation of the faces. Fixing more problematic cases may be 
  possible by generating a new surface using 
  <code>alphashape3d::<a href='http://www.rdocumentation.org/packages/alphashape3d/topics/ashape3d'>ashape3d</a></code> (see examples).</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># check if the vertices in these neurons are inside the mushroom body calyx</span>
<span class='co'># surface object</span>
<span class='no'>inout</span><span class='kw'>=</span><span class='fu'>pointsinside</span>(<span class='no'>kcs20</span>, <span class='kw'>surf</span><span class='kw'>=</span><span class='fu'><a href='subset.html'>subset</a></span>(<span class='no'>MBL.surf</span>, <span class='st'>"MB_CA_L"</span>))
<span class='fu'>table</span>(<span class='no'>inout</span>)</div><div class='output co'>#&gt; inout
#&gt; FALSE  TRUE 
#&gt;  6457  2064 </div><div class='input'>
<span class='co'># be a bit more lenient and include points less than 5 microns from surface</span>
<span class='no'>MBCAL</span><span class='kw'>=</span><span class='fu'><a href='subset.html'>subset</a></span>(<span class='no'>MBL.surf</span>, <span class='st'>"MB_CA_L"</span>)
<span class='no'>inout5</span><span class='kw'>=</span><span class='fu'>pointsinside</span>(<span class='no'>kcs20</span>, <span class='kw'>surf</span><span class='kw'>=</span><span class='no'>MBCAL</span>, <span class='kw'>rval</span><span class='kw'>=</span><span class='st'>'distance'</span>) <span class='kw'>&gt;</span> -<span class='fl'>5</span>
<span class='fu'>table</span>(<span class='no'>inout5</span>)</div><div class='output co'>#&gt; inout5
#&gt; FALSE  TRUE 
#&gt;  5604  2917 </div><div class='input'><span class='co'># show which points are in or out</span>
<span class='co'># Hmm seems like there are a few red points in the vertical lobe</span>
<span class='co'># that are well outside the calyx</span>
<span class='fu'>points3d</span>(<span class='fu'><a href='xyzmatrix.html'>xyzmatrix</a></span>(<span class='no'>kcs20</span>), <span class='kw'>col</span><span class='kw'>=</span><span class='fu'>ifelse</span>(<span class='no'>inout5</span>, <span class='st'>'red'</span>, <span class='st'>'black'</span>))
<span class='fu'><a href='plot3d.html'>plot3d</a></span>(<span class='no'>MBL.surf</span>, <span class='kw'>alpha</span><span class='kw'>=</span><span class='fl'>.3</span>)

<span class='co'># Let's try to make an alphashape for the mesh to clean it up</span>
<span class='fu'>library</span>(<span class='no'>alphashape3d</span>)
<span class='no'>MBCAL.as</span><span class='kw'>=</span><span class='fu'><a href='http://www.rdocumentation.org/packages/alphashape3d/topics/ashape3d'>ashape3d</a></span>(<span class='fu'><a href='xyzmatrix.html'>xyzmatrix</a></span>(<span class='no'>MBCAL</span>), <span class='kw'>alpha</span> <span class='kw'>=</span> <span class='fl'>10</span>)
<span class='co'># Plotting the points, we can see that is much better behaved</span>
<span class='fu'>points3d</span>(<span class='fu'><a href='xyzmatrix.html'>xyzmatrix</a></span>(<span class='no'>kcs20</span>),
  <span class='kw'>col</span><span class='kw'>=</span><span class='fu'>ifelse</span>(<span class='fu'>pointsinside</span>(<span class='no'>kcs20</span>, <span class='no'>MBCAL.as</span>), <span class='st'>'red'</span>, <span class='st'>'black'</span>))</div><div class='input'>
</div><span class='co'># NOT RUN {</span>
<span class='co'># Show the face normals for a surface</span>
<span class='kw'>if</span>(<span class='fu'>require</span>(<span class='st'>'Morpho'</span>)) {
  <span class='co'># convert to a mesh3d object used by rgl and Morpho packge</span>
  <span class='no'>MBCAL.mesh</span><span class='kw'>=</span><span class='fu'><a href='as.mesh3d.html'>as.mesh3d</a></span>(<span class='fu'><a href='subset.html'>subset</a></span>(<span class='no'>MBL.surf</span>, <span class='st'>"MB_CA_L"</span>))
  <span class='no'>fn</span><span class='kw'>=</span><span class='fu'><a href='http://www.rdocumentation.org/packages/Morpho/topics/updateNormals'>facenormals</a></span>(<span class='no'>MBCAL.mesh</span>)
  <span class='fu'>wire3d</span>(<span class='no'>MBCAL.mesh</span>)
  <span class='co'># show that the normals point out of the object</span>
  <span class='fu'><a href='http://www.rdocumentation.org/packages/Morpho/topics/plotNormals'>plotNormals</a></span>(<span class='no'>fn</span>, <span class='kw'>long</span><span class='kw'>=</span><span class='fl'>5</span>, <span class='kw'>col</span><span class='kw'>=</span><span class='st'>'red'</span>)

  <span class='co'># invert the faces of the mesh and show that normals point in</span>
  <span class='no'>MBCAL.inv</span><span class='kw'>=</span><span class='fu'><a href='http://www.rdocumentation.org/packages/Morpho/topics/invertFaces'>invertFaces</a></span>(<span class='no'>MBCAL.mesh</span>)
  <span class='fu'><a href='http://www.rdocumentation.org/packages/Morpho/topics/plotNormals'>plotNormals</a></span>(<span class='fu'><a href='http://www.rdocumentation.org/packages/Morpho/topics/updateNormals'>facenormals</a></span>(<span class='no'>MBCAL.inv</span>), <span class='kw'>long</span><span class='kw'>=</span><span class='fl'>5</span>, <span class='kw'>col</span><span class='kw'>=</span><span class='st'>'cyan'</span>)
}
<span class='co'># }</span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Gregory Jefferis, James Manton.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>

